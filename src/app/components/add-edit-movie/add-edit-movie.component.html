<h1>{{title}}</h1>
<hr>
<div>
  <form class="d-flex flex-column  gap-2" [formGroup]="creationForm" (ngSubmit)="saveMovie()">
    <input formControlName="id" type="number" class="form-control d-none" />

    <div class="d-flex gap-3">
      <div class="d-flex gap-3 flex-column">
        <div class="image-container">
          <img [src]="poster" fetchpriority="low" priority />
        </div>
        <input type="file" accept="image/png, image/jpeg, image/webp ,imaje/jpg" class="flex-fill"
          (change)="loadPoster($event)" />
      </div>
      <mat-grid-list cols="4" class="flex-fill" rowHeight="90">

        <mat-grid-tile [colspan]="2">
          <mat-form-field appearance="outline">
            <mat-label>Name</mat-label>
            <input formControlName="name" matInput>
            @if(formValidators.isError(creationForm,'name')){
            <mat-error> {{formValidators.validate(creationForm,'name','Name')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile [colspan]="2">
          <mat-form-field appearance="outline">
            <mat-label>Original name</mat-label>
            <input formControlName="originalName" matInput>
            @if(formValidators.isError(creationForm,'originalName')){
            <mat-error> {{formValidators.validate(creationForm,'originalName','Original name')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile [colspan]="2">
          <mat-form-field appearance="outline">
            <mat-label>Stafs</mat-label>
            <mat-select multiple="true" formControlName="stafs">
              @for (item of stafs ; track $index){
              <mat-option [value]="item.id">{{item.name}} {{item.surname}}</mat-option>
              }
            </mat-select>
            @if(formValidators.isError(creationForm,'stafs')){
            <mat-error> {{formValidators.validate(creationForm,'stafs','Movie staf')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile [colspan]="2">
          <mat-form-field appearance="outline">
            <mat-label>Genres</mat-label>
            <mat-select multiple="true" formControlName="genres">
              @for (item of genres; track $index){
              <mat-option [value]="item.id">{{item.name}}</mat-option>
              }
            </mat-select>
            @if(formValidators.isError(creationForm,'genres')){
            <mat-error> {{formValidators.validate(creationForm,'genres','Genre')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile [colspan]="4">
          <mat-form-field appearance="outline">
            <mat-label>Trailer Url</mat-label>
            <input formControlName="trailerUrl" matInput>
            @if(formValidators.isError(creationForm,'trailerUrl')){
            <mat-error> {{formValidators.validate(creationForm,'trailerUrl','Trailer Url')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile [colspan]="3">
          <mat-form-field appearance="outline">
            <mat-label>Movie Url</mat-label>
            <input formControlName="movieUrl" matInput>
            @if(formValidators.isError(creationForm,'movieUrl')){
            <mat-error> {{formValidators.validate(creationForm,'movieUrl','Movie Url')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field appearance="outline">
            <mat-label>Quality</mat-label>
            <mat-select formControlName="qualityId">
              @for (item of qualities ; track $index)
              {
              <mat-option [value]="item.id">{{item.name}}</mat-option>
              }
            </mat-select>
            @if(formValidators.isError(creationForm,'qualityId')){
            <mat-error> {{formValidators.validate(creationForm,'qualityId','Quality')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field appearance="outline">
            <mat-label> Movie duration</mat-label>
            <input type="time" matInput formControlName="duration" />
            @if(formValidators.isError(creationForm,'duration')){
            <mat-error> {{formValidators.validate(creationForm,'duration','Duration')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field appearance="outline">
            <mat-label>Country</mat-label>
            <mat-select formControlName="countryId">
              @for (item of countries ; track $index)
              {
              <mat-option [value]="item.id">{{item.name}}</mat-option>
              }
            </mat-select>
            @if(formValidators.isError(creationForm,'countryId')){
            <mat-error> {{formValidators.validate(creationForm,'countryId','Country')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field appearance="outline" class="example-form-field">
            <mat-label>Releas date</mat-label>
            <input formControlName="date" [max]="today" matInput [matDatepicker]="datepicker">
            <mat-hint>MM/DD/YYYY</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="datepicker"></mat-datepicker-toggle>
            <mat-datepicker #datepicker>
              <mat-datepicker-actions>
                <button mat-button matDatepickerCancel>Cancel</button>
                <button mat-raised-button color="primary" matDatepickerApply>Apply</button>
              </mat-datepicker-actions>
            </mat-datepicker>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field appearance="outline">
            <mat-label>Premium</mat-label>
            <mat-select formControlName="premiumId">
              @for (item of premiums; track $index)
              {
              <mat-option [value]="item.id">{{item.name}}</mat-option>
              }
            </mat-select>
            @if(formValidators.isError(creationForm,'premiumId')){
            <mat-error> {{formValidators.validate(creationForm,'premiumId','Premium')}}</mat-error>
            }
          </mat-form-field>
        </mat-grid-tile>
      </mat-grid-list>
    </div>
    <hr>
    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <textarea [rows]="5" style="height:auto" formControlName="description" matInput></textarea>
      @if(formValidators.isError(creationForm,'description'))
      {
      <mat-error> {{formValidators.validate(creationForm,'description','Description')}}</mat-error>
      }
    </mat-form-field>
    <hr>

    <mat-form-field appearance="outline">
      <mat-label>Screenshots</mat-label>
      <input hidden formControlName="screenShots" matInput/>
      <mat-grid-list cols="4" rowHeight="1.8:1">
        @for (item of movieScreens ; track movieScreens;let i = $index) {
        <mat-grid-tile>
          <div class=" screen-container">
            <img src={{item.name}} class="screenshot" fetchpriority="low" priority />
             <button (click)="deleteScreen($event)" class="close btn">
                <mat-icon  id={{i}}>close</mat-icon>
              </button>
          </div>

        </mat-grid-tile>
        }
      </mat-grid-list>
      @if(formValidators.isError(creationForm,'screenShots'))
      {
      <mat-error> {{formValidators.validate(creationForm,'screenShots','Screenshots')}}</mat-error>
      }
      </mat-form-field>
      <input type="file" multiple accept="image/png, image/jpeg, image/webp ,imaje/jpg" class="flex-fill"
      (change)="addScreen($event)" />


    <div class="d-flex gap-3 justify-content-around">
      <button type="submit" class="flex-fill" mat-raised-button color="primary">Save</button>
      <button type="button" class="flex-fill" mat-raised-button color="" routerLink="/movie-table">Cancel</button>
    </div>
  </form>

</div>
